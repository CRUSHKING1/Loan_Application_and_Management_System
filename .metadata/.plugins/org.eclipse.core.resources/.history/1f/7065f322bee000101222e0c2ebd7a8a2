package com.loanapp.emi.util;

public class EmiCalculator {

    private static final BigDecimal MAX_INTEREST_RATE =
            BigDecimal.valueOf(18); // cap

    public static BigDecimal calculateEmi(
            BigDecimal principal,
            int tenure,
            BigDecimal annualInterestRate) {

        BigDecimal rate = annualInterestRate.min(MAX_INTEREST_RATE);

        BigDecimal monthlyRate = rate.divide(
                BigDecimal.valueOf(1200), 6, RoundingMode.HALF_UP);

        BigDecimal numerator =
                principal.multiply(monthlyRate)
                         .multiply((BigDecimal.ONE.add(monthlyRate))
                         .pow(tenure));

        BigDecimal denominator =
                (BigDecimal.ONE.add(monthlyRate)).pow(tenure)
                .subtract(BigDecimal.ONE);

        return numerator.divide(denominator, 2, RoundingMode.HALF_UP);
    }
}
